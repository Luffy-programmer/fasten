package eu.fasten.analyzer.vulnerabilityplugin;

import picocli.CommandLine;

import java.util.List;
import java.util.Optional;

/**
 * Makes vulnerability-plugin module runnable from command line.
 */
@CommandLine.Command(name = "Vulnerability")
public class Main implements Runnable {

    @CommandLine.Option(names = {"-k", "--kafka_server"},
            paramLabel = "server.name:port",
            description = "Kafka server to connect to. Use multiple times for clusters.",
            defaultValue = "localhost:9092")
    List<String> kafkaServers;

    public static void main(String[] args) {
        final int exitCode = new CommandLine(new Main()).execute(args);
        System.exit(exitCode);
    }

    @Override
    public void run() {
        var vulnProducer = new VulnerabilityPlugin.VulnerabilityProducer();
        while (true) {
            Optional<String> out = vulnProducer.produce();
            if (!out.isEmpty()) {
                System.out.println("PAYLOAD: " + out.get());
            } else {
                System.out.println("PAYLOAD: Empty");
            }
        }
    }
}
