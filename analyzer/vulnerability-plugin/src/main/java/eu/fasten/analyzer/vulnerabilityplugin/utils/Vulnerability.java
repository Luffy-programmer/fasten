package eu.fasten.analyzer.vulnerabilityplugin.utils;

import com.google.gson.Gson;
import org.owasp.dependencycheck.utils.Pair;

import java.util.ArrayList;
import java.util.List;
import java.util.Objects;

public class Vulnerability {

    public static class Cpe23Uri {
        private String vendor;
        private String product;
        private String version;

        public Cpe23Uri(String vendor, String product, String version) {
            this.vendor = vendor;
            this.product = product;
            this.version = version;
        }

        public String getVendor() {
            return vendor;
        }

        public void setVendor(String vendor) {
            this.vendor = vendor;
        }

        public String getProduct() {
            return product;
        }

        public void setProduct(String product) {
            this.product = product;
        }

        public String getVersion() {
            return version;
        }

        public void setVersion(String version) {
            this.version = version;
        }

        @Override
        public String toString() {
            return "Cpe23Uri{" +
                    "vendor='" + vendor + '\'' +
                    ", product='" + product + '\'' +
                    ", version='" + version + '\'' +
                    '}';
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) return true;
            if (o == null || getClass() != o.getClass()) return false;
            Cpe23Uri cpe23Uri = (Cpe23Uri) o;
            return Objects.equals(vendor, cpe23Uri.vendor) &&
                    Objects.equals(product, cpe23Uri.product) &&
                    Objects.equals(version, cpe23Uri.version);
        }
    }

    public static class Hunk {
        private int lineNumber;
        private String date;

        public Hunk(int lineNumber, String date) {
            this.lineNumber = lineNumber;
            this.date = date;
        }
    }

    public static class File {
        private String fileName;
        private List<Hunk> hunks;
        private String patchDate;

        public File(String fileName, List<Hunk> hunks, String patchDate) {
            this.fileName = fileName;
            this.hunks = hunks;
            this.patchDate = patchDate;
        }
    }

    private String id;

    private List<Cpe23Uri> cpe23Uris;
    private Double scoreCVSS2;
    private Double scoreCVSS3;

    private String publishedDate;
    private String lastModifiedDate;

    private String description;
    private List<String> references;
    private List<String> patches;
    private List<String> exploits;
    private List<File> vulnerable_files;
    private Long daysToFix;

    private Gson gson = new Gson();

    public Vulnerability(String id) {
        this.id = id;
        this.cpe23Uris = new ArrayList<>();
        this.references = new ArrayList<>();
        this.vulnerable_files = new ArrayList<>();
        this.patches = new ArrayList<>();
        this.exploits = new ArrayList<>();
    }

    public String getId() {
        return id;
    }

    public List<Cpe23Uri> getCpe23Uris() {
        return cpe23Uris;
    }

    public void addCpeUri(Cpe23Uri cpe) {
        this.cpe23Uris.add(cpe);
    }

    public Double getScoreCVSS2() {
        return scoreCVSS2;
    }

    public void setScoreCVSS2(Double scoreCVSS2) {
        this.scoreCVSS2 = scoreCVSS2;
    }

    public Double getScoreCVSS3() {
        return scoreCVSS3;
    }

    public void setScoreCVSS3(Double scoreCVSS3) {
        this.scoreCVSS3 = scoreCVSS3;
    }

    public String getPublishedDate() {
        return publishedDate;
    }

    public void setPublishedDate(String publishedDate) {
        this.publishedDate = publishedDate;
    }

    public String getLastModifiedDate() {
        return lastModifiedDate;
    }

    public void setLastModifiedDate(String lastModifiedDate) {
        this.lastModifiedDate = lastModifiedDate;
    }

    public String getDescription() {
        return description;
    }

    public void setDescription(String description) {
        this.description = description;
    }

    public List<String> getReferences() {
        return this.references;
    }

    public void addReference(String url) {
        this.references.add(url);
    }

    public List<File> getVulnerable_files() {
        return vulnerable_files;
    }

    public void addExploit(String url) {
        this.exploits.add(url);
    }

    public List<String> getExploits() {
        return exploits;
    }

    public void addPatch(String url) {
        this.patches.add(url);
    }

    public List<String> getPatches() {
        return patches;
    }

    public void addVulnerableFile(File vulnerable_file) {
        this.vulnerable_files.add(vulnerable_file);
    }

    public Long getDaysToFix() {
        return daysToFix;
    }

    public void setDaysToFix(Long daysToFix) {
        this.daysToFix = daysToFix;
    }

    @Override
    public String toString() {
        return "Vulnerability{" +
                "id='" + id + '\'' +
                ", cpe23Uris=" + cpe23Uris +
                ", scoreCVSS2=" + scoreCVSS2 +
                ", scoreCVSS3=" + scoreCVSS3 +
                ", publishedDate='" + publishedDate + '\'' +
                ", lastModifiedDate='" + lastModifiedDate + '\'' +
                ", description='" + description + '\'' +
                ", references=" + references +
                ", patches=" + patches +
                ", exploits=" + exploits +
                ", vulnerable_files=" + vulnerable_files +
                '}';
    }

    /**
     * JSON Representation of the Vulnerability using GSON.
     * @return String JSON
     */
    public String toJson() {
        return gson.toJson(this);
    }
}


